<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:adm="http://github.com/adminfaces"
	template="/WEB-INF/templates/template.xhtml">

	<ui:define name="title">Pedido</ui:define>

	<ui:define name="body">
		<adm:breadcrumb title="Lançamento de Carteira" />
		<p:growl id="growl" showDetail="false" sticky="false" escape="true"
			autoUpdate="false" />
		<h:form id="form" prependId="false">
			<p:focus context="capaCarteira" />
			<div class="box box-primary">
				<div class="box-header with-border">
					<!--<div id="main-buttons" class="hidden-sm hidden-xs">
		                	 <p:commandButton value="Salvar" update="@form" icon="fa fa-check" styleClass="btn-primary" action="#{pedidoController.Salvar()}"/> 
		               	</div>
		               	<p:splitButton value="Salvar" update="@form" icon="fa fa-check" styleClass="hidden-md hidden-lg btn-primary"  action="#{pedidoController.Salvar()}"/>
		             	<p:separator/>-->
					<div class="ui-fluid">
						<p:panelGrid id="capaCarteira" columns="2" layout="grid"
							columnClasses="ui-g-6 ui-md-1">
							<p:outputLabel value="Empresa" for="empresa" />
							<p:selectOneMenu id="empresa" disabled="true"
								value="#{pedidoController.entity.empresa}"
								converter="omnifaces.SelectItemsConverter">
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.listaEmpresas}"
									var="item" itemLabel="#{item.nomeFantasia}" itemValue="#{item}" />
							</p:selectOneMenu>
						</p:panelGrid>

						<p:panelGrid columns="6" layout="grid"
							columnClasses="ui-g-6 ui-md-1,ui-g-6 ui-md-2,ui-g-6 ui-md-4,ui-g-6 ui-md-1,ui-g-6 ui-md-6">
							<p:outputLabel value="Data Pedido" for="data" />
							<p:calendar id="data" value="#{pedidoController.entity.dataPedido}"
								pattern="dd/MM/yyyy" size="10" disabled="true"></p:calendar>
							<p:link id="linkCardadpio"
								href="/pages/cardapio/cadastro-cardapio.xhtml?id=#{pedidoController.cardapio.id}"
								target="_blank" title="Clique para abrir o cardápio">
								<i class="fa fa-cutlery" style="color: #{pedidoController.cardapio.id eq null?'red' : 'black'} " ></i>
							</p:link>
							<!-- <p:commandButton icon="fa fa-refresh"
								id="btnAtualizarListaInsumo"
								title="Clique aqui para atualizar o cardápio"
								actionListener="#{pedidoController.atualizarListaPreparo()}"
								styleClass="btn btn-light" /> -->
						
						
						<p:outputLabel value="Cardápio" for="selectCardapio" />
							<p:selectOneMenu id="selectCardapio"
								value="#{pedidoController.entity.cardapio}"
								converter="omnifaces.SelectItemsConverter" 
								filter="true" filterMatchMode="contains">
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.listaCardapio}"
									var="item" itemLabel="#{item.descricaoComDiaSemana}" itemValue="#{item}" />
								 
								<p:ajax event="itemSelect"
									listener="#{pedidoController.obterPratosCardapio()}"
									update="prato,selectTipoPrato,linkCardadpio" />
							</p:selectOneMenu>
						</p:panelGrid>
						<p:panelGrid columns="4" layout="grid"
							columnClasses="ui-g-6 ui-md-1,ui-g-6 ui-md-5,ui-g-6 ui-md-1,ui-g-6 ui-md-5">
							<p:outputLabel value="Cliente" for="cliente" />
							<p:autoComplete id="cliente" value="#{pedidoController.entity.cliente}"
								completeMethod="#{pedidoController.autoCompleteCliente}"
								var="item" itemLabel="#{item.nomeCompletoSituacao}"
								cache="false" maxResults="12"
								emptyMessage="Nenhum item encontrado" minQueryLength="4"
								itemValue="#{item}" converter="clienteConverter"
								forceSelection="true">
								<p:column>
									<h:outputText value="#{item.nomeCompleto}"
										style="#{item.styleDesabilitado}" />
								</p:column>

								<p:column>
									<h:outputText value="#{item.situacaoAtual}"
										style="#{item.styleDesabilitado}" />
								</p:column>

								<p:column>
									<p:link
										href="/pages/cliente/cadastro-cliente.xhtml?id=#{item.id}"
										target="_blank" title="Clique para editar cliente">
										<i class="fa fa-pencil"></i>
									</p:link>
								</p:column>
								<p:ajax event="itemSelect"
									listener="#{pedidoController.obterEnderecoCliente()}"
									update="growl,endereco,cliente,selectEntregador, ordemEntrega,valorDiaria" />
							</p:autoComplete>



							<!--<p:selectOneMenu id="cliente2" value="#{pedidoController.cliente}"  converter= "omnifaces.SelectItemsConverter" 
								    	 filter="true"  filterMatchMode="contains"  var="C"  >
								   		<f:selectItem itemLabel="Selecionar" itemValue=""  noSelectionOption="true"/>
								        <f:selectItems value="#{pedidoController.listaClientes}" var="item" itemLabel="#{item.nomeCompletoSituacao}" itemValue="#{item}"  itemDisabled="#{item.desabilitado}" />
								       	<p:column>
											 <h:outputText value="#{C.nomeCompletoSituacao}" />
										</p:column>
										<p:column >
											<p:link
												href="/pages/cliente/cadastro-cliente.xhtml?id=#{c.id}"
												target="_blank" title="Clique para editar cliente">
												<i class="fa fa-pencil"></i>
											</p:link>
										</p:column> 
								        <p:ajax event="change" update="endereco" listener="#{pedidoController.obterEnderecoCliente()}"/>
								    </p:selectOneMenu>  -->

							<!-- <p:link
									href="/pages/cardapio/cadastro-cliente.xhtml"
										target="_blank" title="Clique para abrir o cardápio">
									<i class="fa fa-cutlery"></i>
									</p:link>
									<p:commandButton icon="fa fa-refresh"
										id="btnAtualizarListaCliente"  title="Clique aqui para atualizar o cardápio"
										actionListener="#{cardapioController.atualizarListaPreparo()}"
									styleClass="btn btn-light" /> -->

						 							<p:outputLabel value="Endereço" for="endereco" />
							<p:selectOneMenu id="endereco"
								value="#{pedidoController.entity.clienteEndereco}"
								converter="omnifaces.SelectItemsConverter"
								filter="true" filterMatchMode="contains"
								disabled="#{pedidoController.entity.cliente eq null}">
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.listaEnderecos}"
									var="item" itemLabel="#{item.enderecoCompleto}"
									itemValue="#{item}" />
								<p:ajax event="change" update="selectTipoPrato,precoPrato"
									listener="#{pedidoController.obterEntregador()}" />
							</p:selectOneMenu>

						</p:panelGrid>
						<p:panelGrid columns="4" layout="grid"
							columnClasses="ui-g-6 ui-md-1,ui-g-6 ui-md-5,ui-g-6 ui-md-1,ui-g-6 ui-md-5 ">

							<p:outputLabel value="Prato" for="prato" />
							<p:selectOneMenu id="prato"
								value="#{pedidoController.entity.cardapioFichaPrato}"
								converter="omnifaces.SelectItemsConverter" 
								filter="true" filterMatchMode="contains">
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.cardapio.pratos}"
									var="item" itemLabel="#{item.descricao}" itemValue="#{item}" />
								<p:ajax event="change" update="selectTipoPrato,precoPrato"
									listener="#{pedidoController.obterTiposDePratos()}" />
							</p:selectOneMenu>
							
							<p:outputLabel value="Qtd.:" for="qtd" />
							<p:inputNumber   value="#{pedidoController.entity.quantidade}"  id="qtd" symbol="" decimalSeparator="," thousandSeparator="." decimalPlaces="0"  />
							
					</p:panelGrid>
						<p:panelGrid columns="4" layout="grid"
							columnClasses="ui-g-6 ui-md-1,ui-g-6 ui-md-5,ui-g-6 ui-md-1,ui-g-6 ui-md-5 ">


							<p:outputLabel value="Tipo de Prato" for="selectTipoPrato" />
							<p:selectOneMenu id="selectTipoPrato" 	disabled="#{pedidoController.entity.cardapioFichaPrato eq null}"
								value="#{pedidoController.entity.fichaTecnicaPratoTipo}" filter="true"
								filterMatchMode="contains"
								converter="omnifaces.SelectItemsConverter" >
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.entity.cardapioFichaPrato.fichaTecnicaPrato.fichaTecnicaPratoTipos}"
									var="item" itemLabel="#{item.tipoPrato.descricao}"
									itemValue="#{item}" />
								<p:ajax event="change" update="precoPrato"
									listener="#{pedidoController.obterPrecoPrato()}" />
							</p:selectOneMenu>
							
							<p:outputLabel value="Preço" for="precoPrato" />
							<p:inputNumber   id="precoPrato" value="#{pedidoController.entity.valorPedido}" 	disabled="#{pedidoController.entity.tipoPrato eq null}" symbol="R$ " decimalSeparator="," thousandSeparator="." /> 
							
							
						
						</p:panelGrid>
						<p:panelGrid id="capaCarteira3" columns="4" layout="grid"
							columnClasses="ui-g-6 ui-md-1,ui-g-6 ui-md-5,ui-g-6 ui-md-1,ui-g-6 ui-md-5">


							<p:outputLabel value="Derivação" for="selectderivacao" />
							<p:selectOneMenu id="selectderivacao"
								value="#{pedidoController.entity.derivacao}" filter="true"
								filterMatchMode="contains"
								converter="omnifaces.SelectItemsConverter">
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.listaDerivacoes}"
									var="item" itemLabel="#{item.descricao}" itemValue="#{item}" />
							</p:selectOneMenu>


							<p:outputLabel value="Forma de Pagamento"
								for="selectFormaPagamento" />
							<p:selectOneMenu id="selectFormaPagamento"
								value="#{pedidoController.entity.formaPagamento}" filter="true"
								filterMatchMode="contains"
								converter="omnifaces.SelectItemsConverter">
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.listaFormasPagamento}"
									var="item" itemLabel="#{item.descricao}" itemValue="#{item}" />
							</p:selectOneMenu>
						</p:panelGrid>
						<p:panelGrid   columns="6" layout="grid" columnClasses="ui-g-6 ui-md-1,ui-g-6 ui-md-6,ui-g-6 ui-md-2,ui-g-6 ui-md-2,ui-g-6 ui-md-1">

							<p:outputLabel value="Entregador" for="selectEntregador" />
							<p:selectOneMenu id="selectEntregador"
								value="#{pedidoController.entity.entregador}" filter="true"
								filterMatchMode="contains"
								converter="omnifaces.SelectItemsConverter">
								<f:selectItem itemLabel="Selecionar" itemValue=""
									noSelectionOption="true" />
								<f:selectItems value="#{pedidoController.listaEntregador}"
									var="item" itemLabel="#{item.nome}" itemValue="#{item}" />
								<p:ajax event="change" update="valorDiaria,ordemEntrega"
									listener="#{pedidoController.alterarEntregador()}" />
							</p:selectOneMenu>
							
							<p:outputLabel value="Ordem de Entrega" for="ordemEntrega" />
							<p:inputNumber   value="#{pedidoController.entity.ordemEntrega}"  id="ordemEntrega" symbol="" decimalSeparator="," thousandSeparator="." decimalPlaces="0"  />
							
							<p:outputLabel value="Diária" for="valorDiaria" />
							<p:inputNumber   id="valorDiaria" value="#{pedidoController.entity.valorDiariaEntregador}" 	
							disabled="true" symbol="R$ " decimalSeparator="," thousandSeparator="." /> 
							

						</p:panelGrid>
						<p:panelGrid   columns="1" layout="grid"  >
							<p:outputLabel for="observacao" value="Observação"/>
		           			<p:inputTextarea id="observacao" value="#{pedidoController.entity.observacao}" rows="5" cols="30" maxlength="450" counter="display" counterTemplate="Faltam {0} characteres" autoResize="false" />
		  					<h:outputText id="display" />
		  				</p:panelGrid>			
		  							
						<div align="right">
							<p:panelGrid>
							
								<p:commandButton value="" icon="fa fa-user-plus"
									id="btnAdicionarMais" styleClass="btn-warning"
									style="width: 50px;" title="Adiconar mais pratos para o mesmo Cliente"
									update="form,growl"
									action="#{pedidoController.adicionarPedido(false)}" />
								
								
								<p:commandButton value="" icon="fa fa-plus"
									id="btnAdicioanr" styleClass="btn-primary"
									style="width: 50px;" title="Adiconar"
									update="form,growl"
									action="#{pedidoController.adicionarPedido(true)}" />
									
								
							</p:panelGrid>
						</div>
						<p:panelGrid columns="1" layout="grid">
							<p:separator />
						</p:panelGrid>
						<p:panel>
						
						
						<p:dataTable id="tabListaPedidos" widgetVar="items" rows="10" 
											paginator="false" value="#{pedidoController.lista}" var="item"
											rowKey="#{item.id}" reflow="true"
											paginatorPosition="bottom" editable="false"
											mptyMessage="Nenhum item encontrado"   sortOrder="DESCENDING"
											paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
											currentPageReportTemplate="" rowsPerPageTemplate="5,10,15,20,30">
										
							<p:column headerText="Data" filterBy="#{item.dataFormatadaPedido}"  
								filterMatchMode="contains" filterStyle="display:none; visibility:hidden;" sortBy="#{item.dataFormatadaPedido}">
							 	<h:outputLabel value="#{item.dataFormatadaPedido}" escape="false" />
							</p:column>
							
							<p:column headerText="Cliente" filterBy="#{item.cliente.nome}"  
								filterMatchMode="contains" filterStyle="display:none; visibility:hidden;" sortBy="#{item.cliente.nome}">
							 	<h:outputLabel value="#{item.cliente.nome}" escape="false" />
							</p:column>
							
							<p:column headerText="Localidade" filterBy="#{item.localidade.descricao}"  
								filterMatchMode="contains" filterStyle="display:none; visibility:hidden;" sortBy="#{item.localidade.descricao}">
							 	<h:outputLabel value="#{item.localidade.descricao}" escape="false" />
							</p:column>
							
							<p:column headerText="Qtd" filterBy="#{item.quantidade}"  
								filterMatchMode="contains" filterStyle="display:none; visibility:hidden;" sortBy="#{item.quantidade}">
							 	<h:outputLabel value="#{item.quantidade}" escape="false" />
							</p:column>
							
							<p:column headerText="Prato" filterBy="#{item.cardapioFichaPrato.descricao}"  
								filterMatchMode="contains" filterStyle="display:none; visibility:hidden;" sortBy="#{item.cardapioFichaPrato.descricao}">
							 	<h:outputLabel value="#{item.cardapioFichaPrato.descricao}" escape="false" />
							</p:column>
							
							<p:column headerText="Tipo" filterBy="#{item.tipoPrato.descricao}"  
								filterMatchMode="contains" filterStyle="display:none; visibility:hidden;" sortBy="#{item.tipoPrato.descricao}">
							 	<h:outputLabel value="#{item.tipoPrato.descricao}" escape="false" />
							</p:column>
							
							<p:column headerText="Derivacao" filterBy="#{item.derivacao.descricao}"  
								filterMatchMode="contains" filterStyle="display:none; visibility:hidden;" sortBy="#{item.derivacao.descricao}">
							 	<h:outputLabel value="#{item.derivacao.descricao}" escape="false" />
							</p:column>
							
							
											 
						</p:dataTable>


						</p:panel>
					</div>
				</div>
			</div>
		</h:form>

	</ui:define>

</ui:composition>
