<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:adm="http://github.com/adminfaces"
	template="/WEB-INF/templates/template.xhtml">

	<ui:define name="title">Pedido - Entrega Prevista</ui:define>

	<ui:define name="body">
		<f:metadata>
			<f:event listener="#{pedidoController.obterEntregasDia()}"
				type="preRenderView"></f:event>
		</f:metadata>
		<adm:breadcrumb title="Pedido-Entregador" />
		<p:growl id="growl" showDetail="false" sticky="false" escape="true"
			autoUpdate="false" />
		<h:form id="form" prependId="false">
			<div class="box box-primary">
				<div class="box-header with-border">
					<div class="ui-fluid">
						<div align="right">
							<p:panel>
								<div align="right">
									<p:panelGrid>

										<p:commandButton value="" icon="fa fa-map-marker"
											id="btnImprimir" style="width: 31px;"
											styleClass="btn btn-info"
											title="Imprimir rota de entrega do dia" update="form,growl"
											ajax="false" action="#{pedidoController.imprimirRotaHoje()}" />

										<p:commandButton value="" icon="fa fa-gavel" id="btnFinalizar"
											style="width: 31px;" styleClass="btn btn-danger"
											title="Finalizar Lançamentos do dia" update="form,growl"
											actionListener="#{pedidoController.finalizarListaPedidos()}" />
									</p:panelGrid>
								</div>


								<p:dataTable id="tabListaPedidos" widgetVar="itens"
									paginator="false" value="#{pedidoController.lista}" var="item"
									rowKey="#{item.id}" reflow="true" paginatorPosition="bottom"
									editable="true" emptyMessage="Nenhum item encontrado"
									sortField="#{item.ordemEntrega}"
									sortBy="#{item.entregador.nome}" expandableRowGroups="true"
									paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
									currentPageReportTemplate=""
									rowsPerPageTemplate="5,10,15,20,30">


									<f:facet name="header">
										<p:panelGrid columns="5" layout="grid">

											<h:outputText value="Data Entrega:" escape="false" />
											<p:calendar id="dtInicial"
												value="#{pedidoController.dataEntrega}" pattern="dd/MM/yyyy"
												size="10" mask="true" showOn="button" locale="pt_BR">
												<p:ajax event="dateSelect"
													listener="#{pedidoController.obterEntregasDia()}"
													update="tabListaPedidos"></p:ajax>
											</p:calendar>
											<h:outputText value="Pesquisar:" escape="false" />
											<p:inputText id="globalFilter"
												onchange="PF('itens').filter();" style="width:150px;"
												placeholder="Pesquisar"
												styleClass="letras-maiusculas semClear" />

											<p:commandButton id="Search" value="" icon="fa fa-search"
												style="font-size: 0.8em;width:3%;" />

										</p:panelGrid>
									</f:facet>

									<p:headerRow>
										<p:column colspan="3">
											<h:outputLabel value="#{item.entregador.nome}" />

											<!--<p:inplace id="inentregador" label="#{item.entregador.nome}"
												editor="true">
												<p:tooltip for="inentregador"
													value="Clique no campo para editar o entregador de todos os pedidos"
													position="top" />
												<p:ajax event="save" update="tabListaPedidos,growl"
													listener="#{pedidoController.atualizarTodosEntregadores(item)}" />
												<p:selectOneMenu id="selectEntregador"
													value="#{item.entregador}" filter="true"
													filterMatchMode="contains" disabled="#{item.confirmado}"
													converter="omnifaces.SelectItemsConverter">
													<f:selectItem itemLabel="Selecionar" itemValue=""
														noSelectionOption="true" />
													<f:selectItems
														value="#{pedidoController.listaEntregadorCarregada}"
														var="itemEntregador" itemLabel="#{itemEntregador.nome}"
														itemValue="#{itemEntregador}"
														itemDisabled="#{itemEntregador.valorDiaria eq null}" />
												</p:selectOneMenu>
											</p:inplace>  -->
										</p:column>
									</p:headerRow>

									<p:column width="5%">
										<p:rowToggler />
									</p:column>

									<p:column headerText="Ordem" filterBy="#{item.ordemEntrega}"
										filterMatchMode="contains"
										filterStyle="display:none; visibility:hidden;" width="8%">

										<p:inplace id="ajaxInplace" label="#{item.ordemEntrega}"
											editor="true">
											<p:ajax event="save" update="tabListaPedidos,growl"
												listener="#{pedidoController.atualizarPedido(item, 'R')}" />
											<p:inputNumber value="#{item.ordemEntrega}" id="ordemEntrega"
												symbol="" decimalSeparator="," thousandSeparator="."
												decimalPlaces="0" disabled="#{item.confirmado}" />
										</p:inplace>


									</p:column>

									<p:column headerText="Cliente" filterBy="#{item.cliente.nome}"
										filterMatchMode="contains"
										filterStyle="display:none; visibility:hidden;">
										<h:outputLabel value="#{item.cliente.id}-#{item.cliente.nome}"
											escape="false" />
										<br />
										<i><h:outputText value="Pedido realizado em:" /> <h:outputText
												value="#{item.dataCadastro}">
												<f:convertDateTime pattern="dd/MM/yy" />
											</h:outputText> </i>
									</p:column>

									<p:column headerText="Localidade"
										filterBy="#{item.localidade.descricao}"
										filterMatchMode="contains"
										filterStyle="display:none; visibility:hidden;">
										<h:outputLabel value="#{item.localidade.descricao}"
											escape="false" />
									</p:column>

									<p:column headerText="Prato"
										filterBy="#{item.cardapioFichaPrato.descricao}"
										filterMatchMode="contains"
										filterStyle="display:none; visibility:hidden;">
										<h:outputLabel value="#{item.cardapioFichaPrato.descricao}"
											escape="false" />
									</p:column>

									<p:column headerText="Forma Pagamento"
										filterBy="#{item.formaPagamento.descricao}"
										filterMatchMode="contains"
										filterStyle="display:none; visibility:hidden;">

										<p:tooltip for="inFormaPagamento"
											value="Clique no campo para editar" position="top" />

										<p:inplace label="#{item.formaPagamento.descricao}"
											editor="true" id="inFormaPagamento">
											<p:ajax event="save" update="tabListaPedidos,growl"
												listener="#{pedidoController.atualizarPedido(item,'F')}" />
											<p:inputNumber id="valor"
												value="#{item.valorPago}"
												symbol="R$ " decimalSeparator="," thousandSeparator="." />
											<p:selectOneMenu id="selectFormaPagamento"
												value="#{item.formaPagamento}" filter="true"
												filterMatchMode="contains" disabled="#{item.confirmado}"
												converter="omnifaces.SelectItemsConverter">
												<f:selectItem itemLabel="Selecionar" itemValue=""
													noSelectionOption="true" />
												<f:selectItems
													value="#{pedidoController.listaFormasPagamento}"
													var="itemFormaPg" itemLabel="#{itemFormaPg.descricao}"
													itemValue="#{itemFormaPg}" />
											</p:selectOneMenu>
										</p:inplace>
									</p:column>

									<p:column headerText="" width="5%"
										filterStyle="display:none; visibility:hidden;">
										<p:tooltip for="tipotaxa"
											value="#{ item.confirmado?'Item confirmado':'Sem confirmação' }"
											position="top" />

										<p:selectBooleanButton id="tipotaxa"
											value="#{item.confirmado}" onLabel=". " offLabel=" ."
											onIcon="fa fa-check" offIcon="fa fa-times" disabled="true" />
									</p:column>




									<p:rowExpansion id="expanded">
										<p:outputPanel id="carDetail" style="text-align:center;">
											<p:panelGrid columns="2">
												<f:facet name="header">
													<h:outputText
														value="Cardápio: #{item.cardapio.descricaoComDiaSemana}" />
												</f:facet>
												<h:outputText value="Observacao:" />

												<p:inplace label="#{item.observacao}" editor="true"
													id="inobservacao">
													<p:tooltip for="inobservacao"
														value="Clique no campo para editar" position="top" />
													<p:ajax event="save" update="tabListaPedidos,growl"
														listener="#{pedidoController.atualizarPedido(item,'O')}" />
													<p:inputTextarea id="observacao" value="#{item.observacao}"
														rows="3" cols="30" maxlength="450" counter="display"
														counterTemplate="Faltam {0} characteres"
														disabled="#{item.confirmado}" autoResize="false" />
													<h:outputText id="display" />
												</p:inplace>
												<h:outputText value="Qtd:" />

												<p:inplace label="#{item.quantidade}" editor="true"
													id="inquantidade">
													<p:tooltip for="inquantidade"
														value="Clique no campo para editar" position="top" />
													<p:ajax event="save" update="tabListaPedidos,growl"
														listener="#{pedidoController.atualizarPedido(item,'Q')}" />
													<p:inputNumber value="#{item.quantidade}" id="qtd"
														disabled="#{item.confirmado}" symbol=""
														decimalSeparator="," thousandSeparator="."
														decimalPlaces="0" />
												</p:inplace>
												<h:outputText value="Tipo:" />
												<h:outputText
													value="#{item.tipoPrato.descricao}-#{item.derivacao.descricao}" />
												<h:outputText value="Entregador" />
												<p:inplace id="inentregadorpedido"
													label="#{item.entregador.nome}" editor="true">
													<p:tooltip for="inentregadorpedido"
														value="Clique no campo para editar" position="top" />
													<p:ajax event="save" update="tabListaPedidos,growl"
														listener="#{pedidoController.atualizarPedido(item,'E')}" />
													<p:selectOneMenu id="selectEntregadorPedido"
														value="#{item.entregador}" filter="true"
														filterMatchMode="contains" disabled="#{item.confirmado}"
														converter="omnifaces.SelectItemsConverter">
														<f:selectItem itemLabel="Selecionar" itemValue=""
															noSelectionOption="true" />
														<f:selectItems
															value="#{pedidoController.listaEntregadorCarregada}"
															var="itemEntregador" itemLabel="#{itemEntregador.nome}"
															itemValue="#{itemEntregador}"
															itemDisabled="#{itemEntregador.valorDiaria eq null}" />
													</p:selectOneMenu>
												</p:inplace>

												<h:outputText value="Valor Diária" />
												<h:outputText value="#{item.valorDiariaEntregador}" />
											</p:panelGrid>
										</p:outputPanel>
									</p:rowExpansion>


								</p:dataTable>



							</p:panel>
						</div>
					</div>
				</div>
			</div>
		</h:form>

	</ui:define>

</ui:composition>
